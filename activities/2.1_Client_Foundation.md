1# Công việc: 2.1 - Xây dựng Nền tảng Client cho Provider

- **Người thực hiện (Implemented by):** [Gemini]
- **Liên quan đến Giai đoạn (Related to Phase):** [2]

---

## 📝 Kế hoạch thực thi (Đã điều chỉnh theo Hiến pháp)

**1. Mục tiêu (Goal):**
*   Xây dựng nền tảng và sườn cho công cụ dòng lệnh (CLI) của Provider, cho phép họ tương tác với mạng lưới NodeLink.

**2. Lý do (Reason):**
*   Tuân thủ "Hiến pháp dự án" bằng cách ưu tiên phát triển CLI để đẩy nhanh tiến độ. Bước này tạo ra công cụ cốt lõi để Provider có thể đăng ký và lắng nghe các job.

**3. Các bước thực hiện (Steps):**
*   **Bước 1: Tạo cấu trúc file cho CLI:**
    *   Tạo thư mục `client/`.
    *   Tạo file chính `client/provider-cli.ts` để xử lý logic cho các lệnh CLI.
    *   Tạo file `client/common.ts` để chứa code kết nối Solana dùng chung.
*   **Bước 2: Phân tích và Cài đặt Dependencies:**
    *   Kiểm tra `package.json` và thêm các thư viện cần thiết cho việc xây dựng CLI bằng Node.js, ví dụ như `commander` để xử lý tham số dòng lệnh.
    *   Chạy `npm install` để cài đặt.
*   **Bước 3: Viết code nền tảng trong `common.ts`:**
    *   Implement các hàm để kết nối mạng, lấy Anchor program, và tải ví từ file.
*   **Bước 4: Xây dựng sườn CLI trong `provider-cli.ts`:**
    *   Sử dụng thư viện `commander` để định nghĩa cấu trúc lệnh ban đầu, ví dụ như lệnh `register`.

---
## 🚀 Quá trình thực hiện (Implementation Process)

*Quy trình này mô tả chi tiết cách các bước trong kế hoạch sẽ được thực thi. Tôi sẽ ghi lại kết quả của từng bước vào đây sau khi được bạn cho phép thực hiện.*

**1. Khởi tạo môi trường:**
   - **Hành động:** Thực thi lệnh `mkdir -p client && touch client/provider-cli.ts client/common.ts`.
   - **Mục đích:** Tạo thư mục `client` và các file sườn `provider-cli.ts` (cho logic CLI) và `common.ts` (cho các hàm dùng chung).

**2. Quản lý Dependencies:**
   - **Hành động:** Đọc file `package.json` để kiểm tra các thư viện đã có.
   - **Hành động:** Thêm thư viện `commander` vào `devDependencies` để xử lý tham số dòng lệnh.
   - **Hành động:** Chạy lệnh `npm install` để tải và cài đặt thư viện mới.
   - **Mục đích:** Chuẩn bị các công cụ cần thiết để xây dựng một ứng dụng CLI chuyên nghiệp.

**3. Xây dựng Module `common.ts`:**
   - **Hành động:** Viết code cho file `client/common.ts`.
   - **Chi tiết:**
     - Import các lớp cần thiết từ `@solana/web3.js` và `@coral-xyz/anchor`.
     - Viết hàm `getConnection()`: Trả về một đối tượng `Connection` đã được cấu hình để kết nối tới Solana Devnet.
     - Viết hàm `getWallet(keypairPath)`: Đọc một file keypair từ đường dẫn được cung cấp và trả về một đối tượng `Keypair` để ký giao dịch.
     - Viết hàm `getProgram(wallet)`: Khởi tạo và trả về đối tượng `Program` của Anchor, là cầu nối để gọi các instruction của smart contract.
   - **Mục đích:** Tạo ra một lớp trừu tượng (abstraction layer) để dễ dàng tương tác với Solana và smart contract từ nhiều nơi trong client.

**4. Xây dựng sườn CLI trong `provider-cli.ts`:**
   - **Hành động:** Viết code cho file `client/provider-cli.ts`.
   - **Chi tiết:**
     - Import `Command` từ `commander` và các hàm từ `common.ts`.
     - Khởi tạo chương trình CLI: `const program = new Command();`.
     - Định nghĩa lệnh `register` cùng với các tùy chọn (options) như `--keypair <path>` để chỉ định ví của provider.
     - Trong hàm `.action()` của lệnh `register`, sẽ gọi các hàm từ `common.ts` và log ra thông báo xác nhận để kiểm tra.
     - Thêm `program.parse(process.argv);` ở cuối file để khởi chạy CLI.
   - **Mục đích:** Tạo ra giao diện dòng lệnh đầu tiên, cho phép người dùng gọi lệnh `register` và đặt nền móng cho việc thêm các lệnh khác sau này.
